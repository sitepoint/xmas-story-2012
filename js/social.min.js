Social=function(){Facebook=function(){var facebook=this;this.set_element_to_post_to_feed_on_click_simple=function(element){if(element){var u=encodeURIComponent(window.location.href);var url='http://www.facebook.com/sharer.php?u='+u;var anchor=wrap_element_in_anchor(element,url);anchor.setAttribute("target","_blank")}else{}};this.set_element_to_post_to_feed_on_click_sharer_php=function(element,post_params){var possible_params=["url","images","title","summary"];if(element){var url="http://www.facebook.com/sharer.php?s=100";for(var i=0;i<possible_params.length;i++){var possible_param_key=possible_params[i];if(possible_param_key in post_params){if(possible_param_key!="images"){var val=encodeURIComponent(post_params[possible_param_key]);url+="&p["+possible_param_key+"]="+val}else{for(var j=0;j<post_params.images.length;j++){var val=encodeURIComponent(post_params[possible_param_key][j]);url+="&p["+possible_param_key+"]["+j+"]="+val}}}}var anchor=wrap_element_in_anchor(element,url);anchor.setAttribute("target","_blank")}else{}};this.set_element_to_post_to_feed_on_click=function(element,post_params){post_params.permissions=["publish_stream"];bind_element_to_facebook_url(element,post_params,'/me/feed');};this.set_element_to_post_to_photos_on_click=function(element,post_params){post_params.permissions=["user_photos","publish_stream"];bind_element_to_facebook_url(element,post_params,'/me/photos')};this.set_options=function(options){facebook.options=options;init_facebook()};function bind_element_to_facebook_url(element,post_params,url,retry_timeout){if(facebook.FB_is_initialised){bind(element,"click",function(){facebook.post_params=post_params;post_to_facebook_via_url(url,post_params)})}else{if(typeof(retry_timeout)=="undefined"){retry_timeout=100}if(retry_timeout<60000){setTimeout(function(){bind_element_to_facebook_url(element,post_params,url,retry_timeout*2)},retry_timeout*2)}}};function post_to_facebook_via_url(url,post_params){facebook.action_if_user_passes_all_tests=function(){FB.api(url,'post',post_params,handle_post_to_feed_response)}try_to_post_to_facebook()};function try_to_post_to_facebook(){FB.getLoginStatus(function(response){if(response.status==='connected'){check_for_permissions()}else{display_click_to_proceed_dialog()}})};function handle_post_to_feed_response(response){if(!response){display_click_to_proceed_dialog()}else if(response.error_code){display_error_status("Facebook had a problem: "+response.error_msg+" (code "+response.error_code+")",'alert-error',6500)}else{if(response.id){display_success_status()}else{display_error_status("The user pressed cancel at the 'accept permissions' prompt for your app")}}};function property_is_in_facebook_options(property){return"options"in facebook&&property in facebook.options};function display_success_status(){if(property_is_in_facebook_options("display_success_status")){facebook.options.display_success_status()}else{display_default_success_status()}};function display_default_success_status(){display_spammy_success_status();};function display_error_status(msg){if(property_is_in_facebook_options("display_error_status")){facebook.options.display_error_status(msg)}else{display_default_error_status(msg)}};function display_default_error_status(msg){display_spammy_error_status(msg);};function check_for_permissions(){FB.api('/me/permissions',function(response){if(response.error){display_error_status("Facebook had a problem: "+response.error.message+" (code "+response.error.code+")")}var perms=response.data[0];var failed=false;for(var i in facebook.post_params.permissions){if(!perms[facebook.post_params.permissions[i]]){failed=true;display_click_to_proceed_dialog()}}if(!failed){facebook.action_if_user_passes_all_tests()}})};function display_click_to_proceed_dialog(){if(property_is_in_facebook_options("display_click_to_proceed_dialog")){facebook.options.display_click_to_proceed_dialog(facebook.login)}else{display_default_click_to_proceed_dialog()}};function display_default_click_to_proceed_dialog(){show_spammy_facebook_dialog()};function login(){var login_params={};if(facebook.post_params&&"permissions"in facebook.post_params){login_params={scope:facebook.post_params.permissions.join()}}FB.login(handle_login_response,login_params)};function handle_login_response(response){if(!response.authResponse){display_error_status("This site wasn't given permission to access your facebook profile.")}else{facebook.action_if_user_passes_all_tests()}};function init_facebook(){facebook.FB_is_initialised=typeof(FB)!="undefined";if(!(facebook.FB_is_initialised)){if(typeof(facebook.options)=="undefined"||!("appId"in facebook.options)){return}var div=document.createElement("div");div.id="fb-root";document.body.appendChild(div);window.fbAsyncInit=function(){FB.init({appId:facebook.options.appId,channelUrl:facebook.options.channelUrl||"",status:true,cookie:true,xfbml:true});FB.getLoginStatus(function(){facebook.FB_is_initialised=true})};(function(d){var js,id='facebook-jssdk',ref=d.getElementsByTagName('script')[0];if(d.getElementById(id)){return}js=d.createElement('script');js.id=id;js.async=true;js.src="//connect.facebook.net/en_US/all.js";ref.parentNode.insertBefore(js,ref)}(document));}}this.test_spammy_facebook_dialog=function(){show_spammy_facebook_dialog()}var spammy_namespace="ridiculous_css_namespace_for_social_that_wont_clash";var spammy={ok_text:"OK",cancel_text:"Cancel",background_id:spammy_namespace+"-dialog_background",dialog_id:spammy_namespace+"-dialog",dialog_text_id:spammy_namespace+"-heading",ok_button_id:spammy_namespace+"-ok_button",cancel_button_id:spammy_namespace+"-cancel_button"};function show_spammy_facebook_dialog(){var dialog_text="You need to let Facebook know you want to continue";var background=get_spammy_dialog_background();var dialog=get_spammy_dialog();var dialog_p=document.createElement("p");dialog_p.id=spammy.dialog_text_id;dialog_p.innerHTML=dialog_text;dialog.appendChild(dialog_p);var dialog_buttons=document.createElement("div");dialog.appendChild(dialog_buttons);var dialog_ok_button=document.createElement("button");dialog_ok_button.id=spammy.ok_button_id;dialog_ok_button.innerHTML=spammy.ok_text;bind(dialog_ok_button,"click",function(){login();close_spammy_dialog()});dialog_buttons.appendChild(dialog_ok_button);var dialog_cancel_button=document.createElement("button");dialog_cancel_button.id=spammy.cancel_button_id;dialog_cancel_button.innerHTML=spammy.cancel_text;bind(dialog_cancel_button,"click",close_spammy_dialog);dialog_buttons.appendChild(dialog_cancel_button);document.body.appendChild(background);document.body.appendChild(dialog);set_spammy_dialog_position(dialog)};function display_spammy_error_status(msg){display_spammy_status(msg,"red")};function display_spammy_success_status(){display_spammy_status("Successful post was made","green")};function display_spammy_status(msg,color){var background=get_spammy_dialog_background();var dialog=get_spammy_dialog();var dialog_p=document.createElement("p");dialog_p.id=spammy.dialog_text_id;dialog_p.innerHTML=msg;dialog_p.style.color=color;dialog.appendChild(dialog_p);var dialog_buttons=document.createElement("div");dialog.appendChild(dialog_buttons);var dialog_ok_button=document.createElement("button");dialog_ok_button.id=spammy.ok_button_id;dialog_ok_button.innerHTML=spammy.ok_text;bind(dialog_ok_button,"click",function(){close_spammy_dialog()});dialog_buttons.appendChild(dialog_ok_button);document.body.appendChild(background);document.body.appendChild(dialog);set_spammy_dialog_position(dialog)};function get_spammy_dialog_background(){var background=document.createElement("div");background.style.position="absolute";background.style.left=0;background.style.top=0;background.style.opacity=0.5;background.style.backgroundColor="#999";background.style.height=window.innerHeight+"px";background.style.width=window.innerWidth+"px";background.id=spammy.background_id;return background};function get_spammy_dialog(){var dialog=document.createElement("div");dialog.id=spammy.dialog_id;dialog.style.position="absolute";dialog.style.opacity=1;dialog.style.textAlign="center";dialog.style.padding="20px";dialog.style.borderRadius="15px";dialog.style.backgroundColor="#FFF";return dialog};function set_spammy_dialog_position(dialog){dialog.style.left=((document.body.clientWidth-dialog.clientWidth)/2)+"px";dialog.style.top=((document.body.clientHeight-dialog.clientHeight)/2)+"px"};function close_spammy_dialog(){var dialog_background=document.getElementById(spammy.background_id);document.body.removeChild(dialog_background);var dialog=document.getElementById(spammy.dialog_id);document.body.removeChild(dialog)}};Twitter=function(){var twitter=this;initialise();this.set_element_to_post_to_twitter_on_click=function(element,post_params){var url_params=parameterise(post_params);var url="https://twitter.com/intent/tweet?"+url_params;if(element.tagName.toLowerCase()=="a"){element.href=url}else{wrap_element_in_anchor(element,url)}};function initialise(){if(typeof(__twttrlr)=="undefined"){var twitter_widgets=document.createElement("script");twitter_widgets.src="//platform.twitter.com/widgets.js";document.body.appendChild(twitter_widgets)}}};this.facebook=new Facebook();this.twitter=new Twitter();function wrap_element_in_anchor(element,url){var anchor=document.createElement("a");anchor.setAttribute("href",url);var parent_el=element.parentNode;var children=parent_el.children;for(var i=0;i<children.length;i++){if(children[i]==element){var next_element=children[i+1];var detached_element=parent_el.removeChild(element);anchor.appendChild(detached_element);if(next_element!=null){parent_el.insertBefore(anchor,next_element)}else{parent_el.appendChild(anchor)}break}}return anchor}function parameterise(a){var s=[],add=function(key,value){s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};for(var key in a){add(key,a[key])};return s.join("&").replace(/%20/g,"+")};function bind(elem,evt,cb){if(elem.addEventListener){elem.addEventListener(evt,cb,false)}else if(elem.attachEvent){elem.attachEvent('on'+evt,function(){cb.call(event.srcElement,event)})}}};